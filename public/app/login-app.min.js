var loginApp=angular.module("loginApp",["ngRoute","ngMaterial","ngMessages","ui.mask","ui.validate"]);loginApp.config(function($routeProvider,$mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("light-blue").accentPalette("orange"),$routeProvider.when("/",{templateUrl:"app/views/pages/login/login.ejs",controller:"loginController"}).otherwise({redirectTo:"/"})}),loginApp.service("authTokenService",["$window",function($window){this.getToken=function(){return $window.localStorage.getItem("token")},this.setToken=function(token){token?$window.localStorage.setItem("token",token):$window.localStorage.removeItem("token")}}]),loginApp.service("loginService",["$http",function($http){this.autenticar=function(email,senha){return $http.post("/api/autenticar",{email:email,senha:senha})}}]),loginApp.service("messageService",["$mdToast",function($mdToast){this.showMessage=function(message){$mdToast.show($mdToast.simple().position("top right").textContent(message))}}]),loginApp.service("utilService",[function(){this.messages={erroProbTec:"Problemas técnicos ocorreram durante a autenticação, tente novamente mais tarde!"}}]),loginApp.controller("loginController",["$scope","$window","loginService","messageService","authTokenService","utilService",function($scope,$window,loginService,messageService,authTokenService,utilService){$scope.loading=!1,$scope.login={email:"",senha:""},$scope.autenticar=function(){$scope.loading=!0,loginService.autenticar($scope.login).then(function(res){if(res.data.success){var token=res.data.token;return authTokenService.setToken(token),void($window.location.href=res.data.redirectTo+"?token="+token)}return authTokenService.setToken(),$scope.loading=!1,void messageService.showMessage(res.data.message)},function(res){authTokenService.setToken(),$scope.loading=!1,messageService.showMessage(utilService.messages.erroProbTec)})}}]);